# MDNS

MDNS 协议介绍

mDNS multicast DNS , 使用 5353 端口，组播地址 224.0.0.251。在一个没有常规 DNS 服务器的小型网络内，可以使用 mDNS 来实现类似 DNS 的编程接口、包格式和操作语义。MDNS 协议的报文与 DNS 的报文结构相同，但有些字段对于 MDNS 来说有新的含义。

每个进入局域网的主机，如果开启了mDNS 服务的话，都会向局域网内的所有主机组播一个消息，我是谁，和我的 IP 地址是多少。然后其他也有该服务的主机就会响应，也会告诉你，它是谁，它的IP地址是多少。mDNS 的域名与普通 DNS 的域名是通过后缀 .local 区分开来的。如果一台终端需要访问一个 mDNS 域名，他就会向局域网内发送组播，询问该域名的 IP 是多少。

例如：

一个设备接入网络，首先查询名称是否冲突，并通告当前服务器信息

冲突检测结束后，发送 MDNS 通告，通知其它设备更新 DNS 缓存

其它设备对该域名访问时，会发起 MDNS 查询

mDNS 原理的简单理解

在局域网内，你要通过一台主机和其他主机进行通信，你需要知道对方的 ip 地址，但是有些时候，你并不知道对方的 ip 地址，因为一般使用 DHCP 动态分配 ip 地址的局域网内，各个主机的 IP 地址是由 DHCP 服务器来帮你分配 IP 地址的。所以在很多情况下，你要知道对方的 IP 地址是比较麻烦的。

mDNS 的工作原理
首先，在 IP 协议里规定了一些保留地址，其中有一个是 224.0.0.251，对应的 IPv6 地址是 [FF02::FB]。

mDNS 协议规定了一个端口，5353。

mDNS 基于 UDP 协议。

每个进入局域网的主机，如果开启了mDNS 服务的话，都会向局域网内的所有主机组播一个消息，我是谁，和我的 IP 地址是多少。然后其他也有该服务的主机就会响应，也会告诉你，它是谁，它的 IP 地址是多少。当然，具体实现要比这个复杂点。

比如，A 主机进入局域网，开启了 mDNS 服务，并向 mDNS 服务注册以下信息：我提供 FTP 服务，我的 IP 是 192.168.1.101，端口是 21。当 B 主机进入局域网，并向 B 主机的 mDNS 服务请求，我要找局域网内 FTP 服务器，B 主机的 mDNS 就会去局域网内向其他的 mDNS 询问，并且最终告诉你，有一个IP地址为 192.168.1.101，端口号是 21 的主机，也就是 A 主机提供 FTP 服务，所以 B 主机就知道了 A 主机的 IP 地址和端口号了。

大概的原理就是这样子，mDNS 提供的服务要远远多于这个，当然服务多但并不复杂。

在 Apple 的设备上（电脑，笔记本，iPhone，iPad 等设备）都提供了这个服务。很多Linux 设备也提供这个服务。Windows 的设备可能没有提供，但是如果安装了iTunes 之类的软件的话，也提供了这个服务。

这样就可以利用这个服务开发一些局域网内的自动发现，然后提供一些局域网内交互的应用了。
